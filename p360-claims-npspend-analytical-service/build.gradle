/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Scala library project to get you started.
 * For more details take a look at the Scala plugin chapter in the Gradle
 * user guide available at https://docs.gradle.org/5.1.1/userguide/scala_plugin.html
 */
buildscript {
    repositories {
        maven { url 'https://repo1.uhc.com/artifactory' }
        mavenCentral()
        maven { url 'https://plugins.gradle.org/m2' }
        jcenter()
    }
}

plugins {
    // Apply the scala plugin to add support for Scala
    id 'scala'
    id "maven"
    id "com.jfrog.artifactory" version "4.9.6"
}

ext {
    isSnapshot = version.endsWith('SNAPSHOT')
    artifactoryUsername = System.properties['ARTIFACTORY_USERNAME']
    artifactoryPassword = System.properties['ARTIFACTORY_PASSWORD']
}

repositories {
    // Use jcenter for resolving your dependencies.
    // You can declare any Maven/Ivy/file repository here.
    mavenCentral()
    maven { url "https://repo1.uhc.com/artifactory/UHG-Snapshots" }
    maven { url "https://repo1.uhc.com/artifactory/UHG-Releases" }
    maven { url "http://packages.confluent.io/maven/" }
    mavenLocal()
}

dependencies {

    compile group: 'org.apache.hadoop', name: 'hadoop-aws', version: '2.8.5'
    // Spark 2.4 dependency
    compile group: 'org.apache.spark', name: 'spark-sql_2.11', version: '2.4.4'
    compile group: 'org.apache.spark', name: 'spark-avro_2.11', version: '2.4.4'
    implementation group: 'org.scala-lang', name: 'scala-library', version: '2.11.12'
    compile group: 'org.apache.commons', name: 'commons-email', version: '1.5'
    compile group: 'org.apache.hadoop', name: 'hadoop-common', version: '2.8.5'
    compile group: 'za.co.absa', name: 'abris_2.11', version: '3.2.2'
    compile group: 'com.fasterxml.jackson.module', name: 'jackson-module-scala_2.11', version: '2.11.2'
    compile group: 'com.amazonaws', name: 'aws-java-sdk', version: '1.11.851'
    compile group: 'org.apache.hadoop', name: 'hadoop-aws', version: '2.8.5'
    compile group: 'org.apache.spark', name: 'spark-sql-kafka-0-10_2.11', version: '2.4.4'

    // Need scala-xml at test runtime
    compile group: 'org.scala-lang.modules', name: 'scala-xml_2.11', version: '1.1.1'

    compile group: 'org.apache.logging.log4j', name: 'log4j-api-scala_2.11', version: '11.0'
    testCompile group: 'org.scalatest', name: 'scalatest_2.11', version: '2.2.5'

}


artifactory {
    contextUrl = "${artifactoryRepo}"
    publish {
        repository {
            //This is only set up to deploy to the UHG-Releases repo, for now...
            repoKey = 'UHG-Releases'
            username = "${artifactoryUsername}"
            password = "${artifactoryPassword}"
            maven = true

        }
        defaults {
            publishConfigs('archives') // this was needed to actually publish jar and not just build info
        }
    }
    resolve {
        repository {
            repoKey = 'libs-snapshots'
            username = "${artifactoryUsername}"
            password = "${artifactoryPassword}"
            maven = true
        }
    }
}


task fatJar(type: Jar) {
    manifest {
        attributes 'Implementation-Title': 'Gradle Jar File Example',
                'Implementation-Version': 1,
                'Main-Class': 'com.p360.adobe.analytics'
    }
    baseName = project.name + '-all'
    from { configurations.compile.collect { it.isDirectory() ? it : zipTree(it) } }
    with jar
}

task spec(dependsOn: ['testClasses'], type: JavaExec) {
    main = 'org.scalatest.tools.Runner'
    args = ['-R', 'build/classes/scala/test', '-o']
    classpath = sourceSets.test.runtimeClasspath
}

compileScala.targetCompatibility = 1.8
ScalaCompileOptions.metaClass.useAnt = false

